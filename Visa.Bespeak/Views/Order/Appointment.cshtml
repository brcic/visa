@{
    Layout = null;
}


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>预定预约</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link href="~/layui/css/layui.css" rel="stylesheet" />
    <script src="~/js/jquery-1.10.2.js"></script>
    <link rel="stylesheet" href="/css/global.css" media="all">
    <script src="~/layui/layui.js"></script>
    <script type="text/javascript">
    var sdate = "@DateTime.Now.ToString("yyyy-MM-dd")";
    var edate = "@DateTime.Now.AddDays(30).ToString("yyyy-MM-dd")";
        var _nowdays = sdate.split('-');
        var nowdate = new Date(_nowdays[0], parseInt(_nowdays[1])-1, _nowdays[2]);
        var starttimes = nowdate.getTime();

        var nextdate = new Date(_nowdays[0], parseInt(_nowdays[1]), 1);
        var endtimes = nextdate.getTime();

        var _currange = "";
        var _curdate = sdate;
        layui.use(['layer', 'element', 'laydate'], function () {
            var layer = layui.layer, element = layui.element, laydate = layui.laydate;
            laydate.render({
                elem: '#calendar1',
                min: sdate,
                max: edate,
                position: 'static',
                showBottom: false,
                theme: 'grid',
                done: function (value, date) {
                    var dateName = value;
                    _curdate = dateName;
                    console.log('你选择的日期是：' + value);
                    var _days = dateName.split('-');
                    var dtweek = new Date(_days[0], parseInt(_days[1]) - 1, _days[2]);
                    if (dtweek.getDay() == 6 || dtweek.getDay() == 0) { $("#tbody1").html(""); return false;}
                    $.ajax({
                        type: 'POST',
                        url: '/Order/checkRange',
                        data: { dateName: dateName },
                        dataType: 'html',
                        success: function (data) {
                            $("#tbody1").html(data);
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {}
                    });
                },
                ready: function (date) {

                    console.log(date);
                    var jsonDate = JSON.stringify(date);
                    var _mon = date.month + "";
                    if (_mon.length == 1)
                    {
                        _mon = "0" + _mon;
                    }
                    var dateName = date.year + "-" + _mon + "-" + date.date;
                    console.log("初始化日期2：" + dateName);
                    _curdate = dateName;
                    $.ajax({
                        type: 'POST',
                        url: '/Order/checkRange',
                        data: { dateName: dateName },
                        dataType: 'html',
                        success: function (data) {
                            $("#tbody1").html(data);
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) { }
                    });
                    $("#calendar1").find("td").each(function () {
                        var weekday = $(this).attr("lay-ymd");
                        var _days = weekday.split('-');
                        var dtweek = new Date(_days[0], parseInt(_days[1])-1, _days[2]);
                        var lktimes = dtweek.getTime();
                        if (lktimes >= starttimes && (dtweek.getDay() == 6 || dtweek.getDay() == 0) && lktimes < endtimes) {
                            $(this).css("color", "#FF6A6A");
                            //console.log("weekday=" + weekday + ";getDay()=" + dtweek.getDay());
                        }
                    })
                },
                change: function (value, date) {
                    var curdate = value + "";
                    _curdate = curdate;
                    var vdays = curdate.split('-');
                    nextdate = new Date(vdays[0], parseInt(vdays[1]), 1);
                    endtimes = nextdate.getTime();
                    $("#calendar1").find("td").each(function () {
                        var weekday = $(this).attr("lay-ymd");
                        var _days = weekday.split('-');
                        var dtweek = new Date(_days[0], parseInt(_days[1]) - 1, _days[2]);
                        var lktimes = dtweek.getTime();
                        if (lktimes >= starttimes && (dtweek.getDay() == 6 || dtweek.getDay() == 0) && lktimes < endtimes) {
                            $(this).css("color", "#FF6A6A");
                            console.log("weekday=" + weekday + ";getDay()=" + dtweek.getDay());
                        }
                    })
                }
            });
            window.checkpay= function ()
            {
                _currange = $("input[name='radioRange']:checked").val();
                if (typeof _currange =="undefined")
                {
                    layer.alert("请选择一个时间段！", function (index) {
                        layer.close(index);
                    });
                    return false;
                }
                var layerid = layer.msg('验证中...', { icon: 16, time: 0, shade: [0.6, '#000', true] });
                $.ajax({
                    type: 'POST',
                    url: '/Order/Appointment',
                    data: { dateName: _curdate, timeName: _currange },
                    dataType: 'json',
                    success: function (data) {
                        layer.close(layerid);
                        var _query = "@Html.Raw(ViewData["vquery"])";
                        window.location.href = "/Order/Confirm?dateName=" + _curdate + "&timeName=" + _currange + "&" + _query;
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) { layer.close(layerid); }
            });
        }
    });

    </script>
</head>
<body>
    <div class="layui-layout layui-layout-admin">
        @Html.Partial("_PartialHeader")
        <div class="layui-body">
            <!-- 内容主体区域 -->
            <div style="padding: 15px;">
               
                <span class="layui-breadcrumb" > <a>预约</a> <a href="/Order/Place">地点</a> <a href="/Order/Applicant">申请人列表</a><a><cite>预约</cite></a> </span>
                <p style="text-align:right;"><b>预约序号： @ViewData["vyyxh"]</b></p>
              
                <div class="layui-row">
                    
                    <div class="layui-col-xs3"><div id="calendar1" style="margin-top:10px"></div></div>
                    <div class="layui-col-xs3">
                     
                        <table class="layui-table">
                          
                            <thead>
                                <tr>
                                    <th>选择</th>
                                    <th>时间范围</th>
                                </tr>
                            </thead>
                            <tbody id="tbody1">
                               
                            </tbody>
                        </table>
                    </div>
                </div>
                <br>
                <br><br><br>
                <div>
                    <a href="javascript:window.history.go(-1)" class="layui-btn layui-btn-big">返回</a>
                    <a href="javascript:checkpay()" class="layui-btn layui-btn-big">确认</a>
                </div>
            </div>
        </div>
        <div class="layui-footer">
            <!-- 底部固定区域 -->
            Copyright 2017. BRCIC Global Visa Center. All Rights Reserved
        </div>
    </div>
   

</body>
</html>
